<script>
	import { today, validateDate } from "../../../../lib/date";

	const oneWayFlight = "one-way";
	const returnFlight = "return";

	let departing = today();
	let returning = departing;

	$: departingError = getErrorMessage(departing);
	$: returningError = getErrorMessage(returning);
	$: if (
		departingError == null &&
		returningError == null &&
		tripType == returnFlight &&
		returning < departing
	) {
		returningError = "Returning date must be on or after departing date.";
	}

	let tripType = oneWayFlight;

	$: isBookDisabled = departingError || returningError;

	function getErrorMessage(date) {
		try {
			validateDate(date);
			return null;
		} catch (error) {
			return error.message;
		}
	}

	function bookFlight() {
		const type = tripType == returnFlight ? "return" : "one-way";

		let message = `You have booked a ${type} flight, leaving ${departing}`;
		if (type === "return") {
			message += ` and returning ${returning}`;
		}

		alert(message);
	}
</script>

<div class="form-group">
	<label class="form-label" for="trip-type">Trip type</label
	><select id="trip-type" class="form-select" bind:value="{tripType}">
		<option value="{oneWayFlight}">one-way flight</option>
		<option value="{returnFlight}">return flight</option>
	</select>
</div>

<div class="form-group {departingError ? 'has-error' : ''}">
	<label class="form-label" for="departing-date">Departing</label
	><input
		id="departing-date"
		class="form-input"
		type="text"
		bind:value="{departing}"
	/>
	{#if departingError}
	<p class="form-input-hint">{departingError}</p>
	{/if}
</div>

<div class="form-group {returningError ? 'has-error' : ''}">
	<label class="form-label" for="returning-date">Returning</label
	><input
		id="returning-date"
		class="form-input"
		type="text"
		bind:value="{returning}"
		disabled="{tripType == oneWayFlight}"
	/>
	{#if returningError}
	<p class="form-input-hint">{returningError}</p>
	{/if}
</div>

<div class="form-group">
	<button
		class="btn btn-primary"
		on:click="{bookFlight}"
		disabled="{isBookDisabled}"
	>
		book
	</button>
</div>
